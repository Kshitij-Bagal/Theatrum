import{r as h,a as k,j as e,u as C,L as _,b as $,f as L}from"./index-d-ClT2-m.js";import{V as D}from"./VideoCard-CSCac-jJ.js";function w({comment:o,onReply:x,onLike:s,onDislike:n}){const[j,d]=h.useState(!1),[l,p]=h.useState(""),v=()=>{l.trim()&&(x(o._id,l),p(""),d(!1))};return e.jsxs("div",{className:"comment",children:[e.jsxs("div",{className:"comment-content",children:[e.jsx("p",{children:o.text}),e.jsxs("div",{className:"comment-actions",children:[e.jsxs("button",{onClick:()=>s(o._id),children:["👍 ",o.likes]}),e.jsxs("button",{onClick:()=>n(o._id),children:["👎 ",o.dislikes]}),e.jsx("button",{onClick:()=>d(!j),children:"💬 Reply"})]}),j&&e.jsxs("div",{className:"reply-form",children:[e.jsx("input",{type:"text",value:l,onChange:u=>p(u.target.value),placeholder:"Write a reply..."}),e.jsx("button",{onClick:v,children:"Reply"})]})]}),o.replies&&o.replies.length>0&&e.jsx("div",{className:"replies",children:o.replies.map(u=>e.jsx(w,{comment:u,onReply:x,onLike:s,onDislike:n},u._id))})]})}function V({videoId:o}){const[x,s]=h.useState([]),[n,j]=h.useState(""),d=k(t=>t.users.user),l=d==null?void 0:d._id,p=d==null?void 0:d.username;h.useEffect(()=>{o&&fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comments`).then(t=>{if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return t.json()}).then(t=>s(t)).catch(t=>console.error("Error fetching comments:",t))},[o]);const v=async()=>{if(n.trim())try{const a=await(await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:l,username:p,text:n})})).json();s(a),j("")}catch(t){console.error("Error adding comment:",t)}},u=async(t,a)=>{try{if(!(await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comment/${t}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:l,username:p,text:a})})).ok)throw new Error("Failed to add reply");const y=await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comments`).then(N=>N.json());s(y)}catch(c){console.error("Error adding reply:",c)}},m=async t=>{try{await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comment/${t}/like`,{method:"POST"}),s(a=>a.map(c=>c._id===t?{...c,likes:c.likes+1}:c))}catch(a){console.error("Error liking comment:",a)}},i=async t=>{try{await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comment/${t}/dislike`,{method:"POST"}),s(a=>a.map(c=>c._id===t?{...c,dislikes:c.dislikes+1}:c))}catch(a){console.error("Error disliking comment:",a)}};return e.jsxs("div",{className:"comments-section",children:[e.jsx("h3",{children:"Comments"}),e.jsxs("div",{className:"add-comment",children:[e.jsx("input",{type:"text",value:n,onChange:t=>j(t.target.value),placeholder:"Add a comment..."}),e.jsx("button",{onClick:v,children:"Post"})]}),e.jsx("div",{className:"comments-list",children:x.length>0?x.map(t=>e.jsx(w,{comment:t,onReply:u,onLike:m,onDislike:i},t._id)):e.jsx("p",{children:"No comments yet. Be the first to comment!"})})]})}function R(){var p,v,u,m;const{videoId:o}=C(),x=k(i=>i.users.user),s=k(i=>{var t,a,c;return(c=(a=(t=i.channel)==null?void 0:t.channels)==null?void 0:a.flatMap(y=>y.videos))==null?void 0:c.find(y=>String(y._id)===o)}),n=k(i=>{var t,a;return(a=(t=i.channel)==null?void 0:t.channels)==null?void 0:a.find(c=>c._id===(s==null?void 0:s.channelId))});if(!s)return e.jsx("h2",{children:"Video not found in description"});if(!n)return e.jsx("h2",{children:"Channel not found in description"});const[j,d]=h.useState(s),l=async i=>{try{const a=await(await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:x._id})})).json();d(a)}catch(t){console.error(`Error updating ${i}:`,t)}};return e.jsxs("div",{className:"video-description",children:[e.jsx("h2",{className:"video-description-title",children:s.title}),e.jsxs("div",{className:"uploader-info",children:[e.jsxs("div",{className:"channel-details",children:[e.jsx("img",{src:n.logo,alt:`${n.name} Logo`,className:"channel-logo"}),e.jsxs("div",{className:"channel-meta",children:[e.jsx(_,{to:`/channel/${n._id}`,children:e.jsx("h3",{className:"channel-name",children:n.name})}),e.jsxs("span",{className:"subscribers",children:[n.subscribers.toLocaleString()," subscribers"]})]})]}),e.jsx("button",{className:"subscribe-btn",children:"Subscribe"})]}),e.jsxs("div",{className:"video-stats",children:[e.jsxs("span",{children:[s.views.toLocaleString()," views"]}),e.jsx("span",{children:new Date(s.uploadDate).toDateString()}),e.jsxs("span",{children:["#",(p=s.tags)==null?void 0:p.join(" #")]})]}),e.jsxs("div",{className:"video-actions",children:[e.jsxs("button",{onClick:()=>l("like"),children:["👍 ",((v=j.likedBy)==null?void 0:v.length)||0]}),e.jsxs("button",{onClick:()=>l("dislike"),children:["👎 ",((u=j.dislikedBy)==null?void 0:u.length)||0]}),e.jsx("button",{children:"🔗 Share"}),e.jsx("button",{children:"⬇️ Download"})]}),e.jsxs("div",{className:"video-description-text",children:[e.jsx("p",{children:s.description}),e.jsx("div",{className:"video-links",children:(m=s.links)==null?void 0:m.map((i,t)=>e.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",children:i.text},t))})]})]})}function P(){var b,S;const o=$(),{channelId:x,videoId:s}=C(),n=h.useRef(null),[j,d]=h.useState(0),[l,p]=h.useState(!1),[v,u]=h.useState(!1);h.useEffect(()=>{o(L())},[o]);const m=k(r=>{var g,f;return(f=(g=r.channel)==null?void 0:g.channels)==null?void 0:f.find(T=>String(T._id)===x)}),i=(b=m==null?void 0:m.videos)==null?void 0:b.find(r=>String(r._id)===s),t=(S=m==null?void 0:m.videos)==null?void 0:S.filter(r=>r._id!==s);h.useEffect(()=>{if(!n.current)return;const r=n.current,g=()=>d(n.current.duration),f=()=>d(n.current.currentTime);return n.current.addEventListener("loadedmetadata",g),n.current.addEventListener("timeupdate",f),()=>{r&&(r.removeEventListener("loadedmetadata",g),r.removeEventListener("timeupdate",f))}},[i]),h.useEffect(()=>{if(!i)return;const r=JSON.parse(sessionStorage.getItem("watchedVideos"))||[];if(!r.some(f=>f.id===s)){const f=[{id:s,title:i.title,timestamp:new Date().toLocaleString()},...r];sessionStorage.setItem("watchedVideos",JSON.stringify(f.slice(0,10)))}},[i,s]);const a=r=>{n.current&&(n.current.currentTime+=r)},c=()=>{p(r=>!r),document.documentElement.classList.toggle("theater-active")},y=()=>{u(r=>!r),document.body.classList.toggle("focus-mode-active",!v)},N=r=>{n.current&&(n.current.playbackRate=r)};if(!m)return e.jsx("div",{children:"Channel not found"});if(!i)return e.jsx("div",{children:"Video not found"});const E=`https://theatrum-server.onrender.com/stream-video/${i._id}.mp4`;return e.jsxs("div",{className:`video-container ${l?"theater-mode":""}`,children:[e.jsxs("div",{className:"vid-section",children:[e.jsxs("div",{className:"video-player",children:[e.jsx("video",{ref:n,src:E||i.url,controls:!0,autoPlay:!0,preload:"metadata",style:{width:"100%"}}),e.jsxs("div",{className:"controls",children:[e.jsx("button",{className:"th-m-btn",onClick:c,children:l?"Exit Theater":"Theater Mode"}),e.jsx("button",{onClick:y,children:v?"Normal Mode":"Dim Background"}),e.jsx("button",{onClick:()=>a(-10),children:"⏪"}),e.jsx("button",{onClick:()=>a(10),children:"⏩"}),e.jsxs("select",{onChange:r=>N(parseFloat(r.target.value)),defaultValue:"1",children:[e.jsx("option",{value:"0.5",children:"0.5x"}),e.jsx("option",{value:"1",children:"1x"}),e.jsx("option",{value:"1.5",children:"1.5x"}),e.jsx("option",{value:"2",children:"2x"})]})]})]}),e.jsx(R,{video:i}),e.jsx(V,{videoId:s})]}),e.jsx("div",{className:"recommended-videos",style:{flexDirection:l?"row":"column"},children:t.map(r=>e.jsx(D,{video:r},r._id))})]})}export{P as default};
