import{r as h,a as k,j as e,u as C,L,b as V,f as D}from"./index-CM61exEb.js";import{V as P}from"./VideoCard-Hweuqi7W.js";function w({comment:o,onReply:p,onLike:s,onDislike:r}){const[x,d]=h.useState(!1),[l,u]=h.useState(""),j=()=>{l.trim()&&(p(o._id,l),u(""),d(!1))};return e.jsxs("div",{className:"comment",children:[e.jsxs("div",{className:"comment-content",children:[e.jsx("p",{children:o.text}),e.jsxs("div",{className:"comment-actions",children:[e.jsxs("button",{onClick:()=>s(o._id),children:["👍 ",o.likes]}),e.jsxs("button",{onClick:()=>r(o._id),children:["👎 ",o.dislikes]}),e.jsx("button",{onClick:()=>d(!x),children:"💬 Reply"})]}),x&&e.jsxs("div",{className:"reply-form",children:[e.jsx("input",{type:"text",value:l,onChange:m=>u(m.target.value),placeholder:"Write a reply..."}),e.jsx("button",{onClick:j,children:"Reply"})]})]}),o.replies&&o.replies.length>0&&e.jsx("div",{className:"replies",children:o.replies.map(m=>e.jsx(w,{comment:m,onReply:p,onLike:s,onDislike:r},m._id))})]})}function O({videoId:o}){const[p,s]=h.useState([]),[r,x]=h.useState(""),d=k(t=>t.users.user),l=d==null?void 0:d._id,u=d==null?void 0:d.username;h.useEffect(()=>{o&&fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comments`).then(t=>{if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return t.json()}).then(t=>s(t)).catch(t=>console.error("Error fetching comments:",t))},[o]);const j=async()=>{if(r.trim())try{const a=await(await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:l,username:u,text:r})})).json();s(a),x("")}catch(t){console.error("Error adding comment:",t)}},m=async(t,a)=>{try{if(!(await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comment/${t}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:l,username:u,text:a})})).ok)throw new Error("Failed to add reply");const f=await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comments`).then(b=>b.json());s(f)}catch(c){console.error("Error adding reply:",c)}},y=async t=>{try{await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comment/${t}/like`,{method:"POST"}),s(a=>a.map(c=>c._id===t?{...c,likes:c.likes+1}:c))}catch(a){console.error("Error liking comment:",a)}},i=async t=>{try{await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/comment/${t}/dislike`,{method:"POST"}),s(a=>a.map(c=>c._id===t?{...c,dislikes:c.dislikes+1}:c))}catch(a){console.error("Error disliking comment:",a)}};return e.jsxs("div",{className:"comments-section",children:[e.jsx("h3",{children:"Comments"}),e.jsxs("div",{className:"add-comment",children:[e.jsx("input",{type:"text",value:r,onChange:t=>x(t.target.value),placeholder:"Add a comment..."}),e.jsx("button",{onClick:j,children:"Post"})]}),e.jsx("div",{className:"comments-list",children:p.length>0?p.map(t=>e.jsx(w,{comment:t,onReply:m,onLike:y,onDislike:i},t._id)):e.jsx("p",{children:"No comments yet. Be the first to comment!"})})]})}function R(){var u,j,m,y;const{videoId:o}=C(),p=k(i=>i.users.user),s=k(i=>{var t,a,c;return(c=(a=(t=i.channel)==null?void 0:t.channels)==null?void 0:a.flatMap(f=>f.videos))==null?void 0:c.find(f=>String(f._id)===o)}),r=k(i=>{var t,a;return(a=(t=i.channel)==null?void 0:t.channels)==null?void 0:a.find(c=>c._id===(s==null?void 0:s.channelId))});if(!s)return e.jsx("h2",{children:"Video not found in description"});if(!r)return e.jsx("h2",{children:"Channel not found in description"});const[x,d]=h.useState(s),l=async i=>{try{const a=await(await fetch(`https://theatrum-server.onrender.com/api/videos/${o}/${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:p._id})})).json();d(a)}catch(t){console.error(`Error updating ${i}:`,t)}};return e.jsxs("div",{className:"video-description",children:[e.jsx("h2",{className:"video-description-title",children:s.title}),e.jsxs("div",{className:"uploader-info",children:[e.jsxs("div",{className:"channel-details",children:[e.jsx("img",{src:r.logo,alt:`${r.name} Logo`,className:"channel-logo"}),e.jsxs("div",{className:"channel-meta",children:[e.jsx(L,{to:`/channel/${r._id}`,children:e.jsx("h3",{className:"channel-name",children:r.name})}),e.jsxs("span",{className:"subscribers",children:[r.subscribers.toLocaleString()," subscribers"]})]})]}),e.jsx("button",{className:"subscribe-btn",children:"Subscribe"})]}),e.jsxs("div",{className:"video-stats",children:[e.jsxs("span",{children:[s.views.toLocaleString()," views"]}),e.jsx("span",{children:new Date(s.uploadDate).toDateString()}),e.jsxs("span",{children:["#",(u=s.tags)==null?void 0:u.join(" #")]})]}),e.jsxs("div",{className:"video-actions",children:[e.jsxs("button",{onClick:()=>l("like"),children:["👍 ",((j=x.likedBy)==null?void 0:j.length)||0]}),e.jsxs("button",{onClick:()=>l("dislike"),children:["👎 ",((m=x.dislikedBy)==null?void 0:m.length)||0]}),e.jsx("button",{children:"🔗 Share"}),e.jsx("button",{children:"⬇️ Download"})]}),e.jsxs("div",{className:"video-description-text",children:[e.jsx("p",{children:s.description}),e.jsx("div",{className:"video-links",children:(y=s.links)==null?void 0:y.map((i,t)=>e.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",children:i.text},t))})]})]})}function J(){var N,S;const o=V(),{channelId:p,videoId:s}=C(),r=h.useRef(null),[x,d]=h.useState(0),[l,u]=h.useState(!1),[j,m]=h.useState(!1),y="http://localhost:8000";h.useEffect(()=>{o(D())},[o]);const i=k(n=>{var g,v;return(v=(g=n.channel)==null?void 0:g.channels)==null?void 0:v.find($=>String($._id)===p)}),t=(N=i==null?void 0:i.videos)==null?void 0:N.find(n=>String(n._id)===s),a=(S=i==null?void 0:i.videos)==null?void 0:S.filter(n=>n._id!==s);h.useEffect(()=>{if(!r.current)return;const n=r.current,g=()=>d(r.current.duration),v=()=>d(r.current.currentTime);return r.current.addEventListener("loadedmetadata",g),r.current.addEventListener("timeupdate",v),()=>{n&&(n.removeEventListener("loadedmetadata",g),n.removeEventListener("timeupdate",v))}},[t]),h.useEffect(()=>{if(!t)return;const n=JSON.parse(sessionStorage.getItem("watchedVideos"))||[];if(!n.some(v=>v.id===s)){const v=[{id:s,title:t.title,timestamp:new Date().toLocaleString()},...n];sessionStorage.setItem("watchedVideos",JSON.stringify(v.slice(0,10)))}},[t,s]);const c=n=>{r.current&&(r.current.currentTime+=n)},f=()=>{u(n=>!n),document.documentElement.classList.toggle("theater-active")},b=async()=>{try{await fetch(`${y}/api/videos/${t._id}/view`,{method:"POST"})}catch(n){console.error("Failed to update view count:",n)}},T=()=>{m(n=>!n),document.body.classList.toggle("focus-mode-active",!j)},E=n=>{r.current&&(r.current.playbackRate=n)};if(!i)return e.jsx("div",{children:"Channel not found"});if(!t)return e.jsx("div",{children:"Video not found"});const _=`http://localhost:8000/stream-video/${t._id}`;return e.jsxs("div",{className:`video-container ${l?"theater-mode":""}`,children:[e.jsxs("div",{className:"vid-section",children:[e.jsxs("div",{className:"video-player",children:[e.jsx("video",{ref:r,src:_||t.url,controls:!0,autoPlay:!0,onPlay:b,preload:"metadata",style:{width:"100%"}}),e.jsxs("div",{className:"controls",children:[e.jsx("button",{className:"th-m-btn",onClick:f,children:l?"Exit Theater":"Theater Mode"}),e.jsx("button",{onClick:T,children:j?"Normal Mode":"Dim Background"}),e.jsx("button",{onClick:()=>c(-10),children:"⏪"}),e.jsx("button",{onClick:()=>c(10),children:"⏩"}),e.jsxs("select",{onChange:n=>E(parseFloat(n.target.value)),defaultValue:"1",children:[e.jsx("option",{value:"0.5",children:"0.5x"}),e.jsx("option",{value:"1",children:"1x"}),e.jsx("option",{value:"1.5",children:"1.5x"}),e.jsx("option",{value:"2",children:"2x"})]})]})]}),e.jsx(R,{video:t}),e.jsx(O,{videoId:s})]}),e.jsx("div",{className:"recommended-videos",style:{flexDirection:l?"row":"column"},children:a.map(n=>e.jsx(P,{video:n},n._id))})]})}export{J as default};
