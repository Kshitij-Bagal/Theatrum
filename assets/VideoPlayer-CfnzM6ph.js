import{r as l,a as k,j as e,u as w,L as C,b as F,f as O}from"./index-DU0KpIvo.js";import{F as R,a as M}from"./index-CwRFEMWb.js";/* empty css                  */function E({comment:a,onReply:h,onLike:i,onDislike:o}){const[c,d]=l.useState(!1),[v,m]=l.useState(""),j=()=>{v.trim()&&(h(a._id,v),m(""),d(!1))};return e.jsxs("div",{className:"comment",children:[e.jsxs("div",{className:"comment-content",children:[e.jsx("p",{children:a.text}),e.jsxs("div",{className:"comment-actions",children:[e.jsxs("button",{onClick:()=>i(a._id),children:["👍 ",a.likes]}),e.jsxs("button",{onClick:()=>o(a._id),children:["👎 ",a.dislikes]}),e.jsx("button",{onClick:()=>d(!c),children:"💬 Reply"})]}),c&&e.jsxs("div",{className:"reply-form",children:[e.jsx("input",{type:"text",value:v,onChange:u=>m(u.target.value),placeholder:"Write a reply..."}),e.jsx("button",{onClick:j,children:"Reply"})]})]}),a.replies&&a.replies.length>0&&e.jsx("div",{className:"replies",children:a.replies.map(u=>e.jsx(E,{comment:u,onReply:h,onLike:i,onDislike:o},u._id))})]})}function U({videoId:a}){const[h,i]=l.useState([]),[o,c]=l.useState(""),d=k(s=>s.users.user),v=d==null?void 0:d._id,m=d==null?void 0:d.username;l.useEffect(()=>{a&&fetch(`https://theatrum-server.onrender.com/api/videos/${a}/comments`).then(s=>{if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);return s.json()}).then(s=>i(s)).catch(s=>console.error("Error fetching comments:",s))},[a]);const j=async()=>{if(o.trim())try{const n=await(await fetch(`https://theatrum-server.onrender.com/api/videos/${a}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:v,username:m,text:o})})).json();i(n),c("")}catch(s){console.error("Error adding comment:",s)}},u=async(s,n)=>{try{if(!(await fetch(`https://theatrum-server.onrender.com/api/videos/${a}/comment/${s}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:v,username:m,text:n})})).ok)throw new Error("Failed to add reply");const f=await fetch(`https://theatrum-server.onrender.com/api/videos/${a}/comments`).then(y=>y.json());i(f)}catch(r){console.error("Error adding reply:",r)}},g=async s=>{try{await fetch(`https://theatrum-server.onrender.com/api/videos/${a}/comment/${s}/like`,{method:"POST"}),i(n=>n.map(r=>r._id===s?{...r,likes:r.likes+1}:r))}catch(n){console.error("Error liking comment:",n)}},N=async s=>{try{await fetch(`https://theatrum-server.onrender.com/api/videos/${a}/comment/${s}/dislike`,{method:"POST"}),i(n=>n.map(r=>r._id===s?{...r,dislikes:r.dislikes+1}:r))}catch(n){console.error("Error disliking comment:",n)}};return e.jsxs("div",{className:"comments-section",children:[e.jsx("h3",{children:"Comments"}),e.jsxs("div",{className:"add-comment",children:[e.jsx("input",{type:"text",value:o,onChange:s=>c(s.target.value),placeholder:"Add a comment..."}),e.jsx("button",{onClick:j,children:"Post"})]}),e.jsx("div",{className:"comments-list",children:h.length>0?h.map(s=>e.jsx(E,{comment:s,onReply:u,onLike:g,onDislike:N},s._id)):e.jsx("p",{children:"No comments yet. Be the first to comment!"})})]})}function A(){var j,u,g,N;const{videoId:a}=w(),h=k(s=>s.users.user),i=k(s=>{var n,r,f;return(f=(r=(n=s.channel)==null?void 0:n.channels)==null?void 0:r.flatMap(y=>y.videos))==null?void 0:f.find(y=>String(y._id)===a)}),o=k(s=>{var n,r;return(r=(n=s.channel)==null?void 0:n.channels)==null?void 0:r.find(f=>f._id===(i==null?void 0:i.channelId))});if(!i)return e.jsx("h2",{children:"Video not found in description"});if(!o)return e.jsx("h2",{children:"Channel not found in description"});const[c,d]=l.useState(i),v=()=>{alert(`You have Subscribed To ${o.title}`)},m=async s=>{try{const r=await(await fetch(`https://theatrum-server.onrender.com/api/videos/${a}/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h._id})})).json();d(r)}catch(n){console.error(`Error updating ${s}:`,n)}};return e.jsxs("div",{className:"video-description",children:[e.jsx("h2",{className:"video-description-title",children:i.title}),e.jsxs("div",{className:"uploader-info",children:[e.jsxs("div",{className:"channel-details",children:[e.jsx("img",{src:o.logo,alt:`${o.name} Logo`,className:"channel-logo"}),e.jsxs("div",{className:"channel-meta",children:[e.jsx(C,{to:`/channel/${o._id}`,children:e.jsx("h3",{className:"channel-name",children:o.name})}),e.jsxs("span",{className:"subscribers",children:[o.subscribers.toLocaleString()," subscribers"]})]})]}),e.jsx("button",{onClick:v,className:"subscribe-btn",children:"Subscribe"})]}),e.jsxs("div",{className:"video-stats",children:[e.jsxs("span",{children:[i.views.toLocaleString()," views"]}),e.jsx("span",{children:new Date(i.uploadDate).toDateString()}),e.jsxs("span",{children:["#",(j=i.tags)==null?void 0:j.join(" #")]})]}),e.jsxs("div",{className:"video-actions",children:[e.jsxs("button",{onClick:()=>m("like"),children:["👍 ",((u=c.likedBy)==null?void 0:u.length)||0]}),e.jsxs("button",{onClick:()=>m("dislike"),children:["👎 ",((g=c.dislikedBy)==null?void 0:g.length)||0]}),e.jsx("button",{children:"🔗 Share"}),e.jsx("button",{children:"⬇️ Download"})]}),e.jsxs("div",{className:"video-description-text",children:[e.jsx("p",{children:i.description}),e.jsx("div",{className:"video-links",children:(N=i.links)==null?void 0:N.map((s,n)=>e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",children:s.text},n))})]})]})}function W(){var b,S;const a=F(),{channelId:h,videoId:i}=w(),o=l.useRef(null),[c,d]=l.useState(null),[v,m]=l.useState(0),[j,u]=l.useState(!1),[g,N]=l.useState(!1),s="http://localhost:8000";l.useEffect(()=>{a(O())},[a]);const n=k(t=>{var p,x;return(x=(p=t.channel)==null?void 0:p.channels)==null?void 0:x.find(V=>String(V._id)===h)}),r=(b=n==null?void 0:n.videos)==null?void 0:b.find(t=>String(t._id)===i),f=(S=n==null?void 0:n.videos)==null?void 0:S.filter(t=>t._id!==i);l.useEffect(()=>{(async()=>{try{const p=await fetch(`${s}/api/channels/${h}`);if(!p.ok)throw new Error("Failed to fetch channel");const x=await p.json();d(x)}catch(p){console.error("Error fetching channel:",p)}})()},[h]),l.useEffect(()=>{if(!o.current)return;const t=o.current,p=()=>m(o.current.duration),x=()=>m(o.current.currentTime);return o.current.addEventListener("loadedmetadata",p),o.current.addEventListener("timeupdate",x),()=>{t&&(t.removeEventListener("loadedmetadata",p),t.removeEventListener("timeupdate",x))}},[r]),l.useEffect(()=>{if(!r)return;const t=JSON.parse(sessionStorage.getItem("watchedVideos"))||[];if(!t.some(x=>x.id===i)){const x=[{id:i,title:r.title,timestamp:new Date().toLocaleString()},...t];sessionStorage.setItem("watchedVideos",JSON.stringify(x.slice(0,10)))}},[r,i]);const y=t=>{o.current&&(o.current.currentTime+=t)},T=()=>{u(t=>!t),document.documentElement.classList.toggle("theater-active")},$=async()=>{try{await fetch(`${s}/api/videos/${r._id}/view`,{method:"POST"})}catch(t){console.error("Failed to update view count:",t)}},_=()=>{N(t=>!t),document.body.classList.toggle("focus-mode-active",!g)},D=t=>{o.current&&(o.current.playbackRate=t)};if(!n)return e.jsx("div",{children:"Channel not found"});if(!r)return e.jsx("div",{children:"Video not found"});const L=`http://localhost:8000/stream-video/${r._id}`,P=({video:t})=>e.jsx("div",{className:"video-card",children:e.jsxs(C,{to:`/${c==null?void 0:c._id}/${t._id}`,className:"video-link",children:[e.jsx("img",{src:t.thumbnailUrl,alt:t.title,className:"thumbnail"}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"channel-avatar",children:e.jsx("img",{src:(c==null?void 0:c.logo)||"default-logo.png",alt:"Channel Avatar"})}),e.jsxs("div",{className:"video-info",children:[e.jsx("h3",{className:"video-title",children:t.title}),e.jsx("span",{className:"channel-name",children:(c==null?void 0:c.name)||"Unknown Channel"}),e.jsxs("div",{className:"video-stats",children:[e.jsxs("span",{children:[e.jsx(R,{})," ",t.views||0," views"]}),e.jsxs("span",{children:[e.jsx(M,{})," ",t.likes||0," likes"]})]})]})]})]})});return e.jsxs("div",{className:`video-container ${j?"theater-mode":""}`,children:[e.jsxs("div",{className:"vid-section",children:[e.jsxs("div",{className:"video-player",children:[e.jsx("video",{ref:o,src:L||r.url,controls:!0,autoPlay:!0,onPlay:$,preload:"metadata",style:{width:"100%"}}),e.jsxs("div",{className:"controls",children:[e.jsx("button",{className:"th-m-btn",onClick:T,children:j?"Exit Theater":"Theater Mode"}),e.jsx("button",{onClick:_,children:g?"Normal Mode":"Dim Background"}),e.jsx("button",{onClick:()=>y(-10),children:"⏪"}),e.jsx("button",{onClick:()=>y(10),children:"⏩"}),e.jsxs("select",{onChange:t=>D(parseFloat(t.target.value)),defaultValue:"1",children:[e.jsx("option",{value:"0.5",children:"0.5x"}),e.jsx("option",{value:"1",children:"1x"}),e.jsx("option",{value:"1.5",children:"1.5x"}),e.jsx("option",{value:"2",children:"2x"})]})]})]}),e.jsx(A,{video:r}),e.jsx(U,{videoId:i})]}),e.jsx("div",{className:"recommended-videos",style:{flexDirection:j?"row":"column"},children:f.map(t=>e.jsx(P,{video:t},t._id))})]})}export{W as default};
