import{r as d,j as e,u as C,a as k,L as _,b as $,f as L}from"./index-BLwjDCQM.js";import{V as D}from"./VideoCard-C1McWVxo.js";function S({comment:i,onReply:m,onLike:o,onDislike:n}){const[u,p]=d.useState(!1),[l,x]=d.useState(""),j=()=>{l.trim()&&(m(i._id,l),x(""),p(!1))};return e.jsxs("div",{className:"comment",children:[e.jsxs("div",{className:"comment-content",children:[e.jsx("p",{children:i.text}),e.jsxs("div",{className:"comment-actions",children:[e.jsxs("button",{onClick:()=>o(i._id),children:["ðŸ‘ ",i.likes]}),e.jsxs("button",{onClick:()=>n(i._id),children:["ðŸ‘Ž ",i.dislikes]}),e.jsx("button",{onClick:()=>p(!u),children:"ðŸ’¬ Reply"})]}),u&&e.jsxs("div",{className:"reply-form",children:[e.jsx("input",{type:"text",value:l,onChange:s=>x(s.target.value),placeholder:"Write a reply..."}),e.jsx("button",{onClick:j,children:"Reply"})]})]}),i.replies&&i.replies.length>0&&e.jsx("div",{className:"replies",children:i.replies.map(s=>e.jsx(S,{comment:s,onReply:m,onLike:o,onDislike:n},s._id))})]})}function V({videoId:i}){const[m,o]=d.useState([]),[n,u]=d.useState("");d.useEffect(()=>{i&&fetch(`http://localhost:8000/api/videos/${i}/comments`).then(s=>{if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);return s.json()}).then(s=>o(s)).catch(s=>console.error("Error fetching comments:",s))},[i]);const p=async()=>{if(n.trim())try{const a=await(await fetch(`http://localhost:8000/api/videos/${i}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n})})).json();o(a),u("")}catch(s){console.error("Error adding comment:",s)}},l=async(s,a)=>{try{const c=await(await fetch(`http://localhost:8000/api/videos/${i}/comment/${s}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a})})).json();o(c)}catch(t){console.error("Error adding reply:",t)}},x=async s=>{try{await fetch(`http://localhost:8000/api/videos/${i}/comment/${s}/like`,{method:"POST"}),o(a=>a.map(t=>t._id===s?{...t,likes:t.likes+1}:t))}catch(a){console.error("Error liking comment:",a)}},j=async s=>{try{await fetch(`http://localhost:8000/api/videos/${i}/comment/${s}/dislike`,{method:"POST"}),o(a=>a.map(t=>t._id===s?{...t,dislikes:t.dislikes+1}:t))}catch(a){console.error("Error disliking comment:",a)}};return e.jsxs("div",{className:"comments-section",children:[e.jsx("h3",{children:"Comments"}),e.jsxs("div",{className:"add-comment",children:[e.jsx("input",{type:"text",value:n,onChange:s=>u(s.target.value),placeholder:"Add a comment..."}),e.jsx("button",{onClick:p,children:"Post"})]}),e.jsx("div",{className:"comments-list",children:m.length>0?m.map(s=>e.jsx(S,{comment:s,onReply:l,onLike:x,onDislike:j},s._id)):e.jsx("p",{children:"No comments yet. Be the first to comment!"})})]})}function R(){var x,j,s,a;const{videoId:i}=C(),m=k(t=>t.users.user),o=k(t=>{var c,h,f;return(f=(h=(c=t.channel)==null?void 0:c.channels)==null?void 0:h.flatMap(v=>v.videos))==null?void 0:f.find(v=>String(v._id)===i)}),n=k(t=>{var c,h;return(h=(c=t.channel)==null?void 0:c.channels)==null?void 0:h.find(f=>f._id===(o==null?void 0:o.channelId))});if(!o)return e.jsx("h2",{children:"Video not found in description"});if(!n)return e.jsx("h2",{children:"Channel not found in description"});const[u,p]=d.useState(o),l=async t=>{try{const h=await(await fetch(`http://localhost:8000/api/videos/${i}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:m._id})})).json();p(h)}catch(c){console.error(`Error updating ${t}:`,c)}};return e.jsxs("div",{className:"video-description",children:[e.jsx("h2",{className:"video-description-title",children:o.title}),e.jsxs("div",{className:"uploader-info",children:[e.jsxs("div",{className:"channel-details",children:[e.jsx("img",{src:n.logo,alt:`${n.name} Logo`,className:"channel-logo"}),e.jsxs("div",{className:"channel-meta",children:[e.jsx(_,{to:`/channel/${n._id}`,children:e.jsx("h3",{className:"channel-name",children:n.name})}),e.jsxs("span",{className:"subscribers",children:[n.subscribers.toLocaleString()," subscribers"]})]})]}),e.jsx("button",{className:"subscribe-btn",children:"Subscribe"})]}),e.jsxs("div",{className:"video-stats",children:[e.jsxs("span",{children:[o.views.toLocaleString()," views"]}),e.jsx("span",{children:new Date(o.uploadDate).toDateString()}),e.jsxs("span",{children:["#",(x=o.tags)==null?void 0:x.join(" #")]})]}),e.jsxs("div",{className:"video-actions",children:[e.jsxs("button",{onClick:()=>l("like"),children:["ðŸ‘ ",((j=u.likedBy)==null?void 0:j.length)||0]}),e.jsxs("button",{onClick:()=>l("dislike"),children:["ðŸ‘Ž ",((s=u.dislikedBy)==null?void 0:s.length)||0]}),e.jsx("button",{children:"ðŸ”— Share"}),e.jsx("button",{children:"â¬‡ï¸ Download"})]}),e.jsxs("div",{className:"video-description-text",children:[e.jsx("p",{children:o.description}),e.jsx("div",{className:"video-links",children:(a=o.links)==null?void 0:a.map((t,c)=>e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:t.text},c))})]})]})}function O(){var b,N;const i=$(),{channelId:m,videoId:o}=C(),n=d.useRef(null),[u,p]=d.useState(0),[l,x]=d.useState(!1),[j,s]=d.useState(!1);d.useEffect(()=>{i(L())},[i]);const a=k(r=>{var y,g;return(g=(y=r.channel)==null?void 0:y.channels)==null?void 0:g.find(E=>String(E._id)===m)}),t=(b=a==null?void 0:a.videos)==null?void 0:b.find(r=>String(r._id)===o),c=(N=a==null?void 0:a.videos)==null?void 0:N.filter(r=>r._id!==o);d.useEffect(()=>{if(!n.current)return;const r=n.current,y=()=>p(n.current.duration),g=()=>p(n.current.currentTime);return n.current.addEventListener("loadedmetadata",y),n.current.addEventListener("timeupdate",g),()=>{r&&(r.removeEventListener("loadedmetadata",y),r.removeEventListener("timeupdate",g))}},[t]);const h=r=>{n.current&&(n.current.currentTime+=r)},f=()=>{x(r=>!r),document.documentElement.classList.toggle("theater-active")},v=()=>{s(r=>!r),document.body.classList.toggle("focus-mode-active",!j)},T=r=>{n.current&&(n.current.playbackRate=r)};if(!a)return e.jsx("div",{children:"Channel not found"});if(!t)return e.jsx("div",{children:"Video not found"});const w=`http://localhost:8000/stream-video/${t._id}.mp4`;return e.jsxs("div",{className:`video-container ${l?"theater-mode":""}`,children:[e.jsxs("div",{className:"vid-section",children:[e.jsxs("div",{className:"video-player",children:[e.jsx("video",{ref:n,src:w,controls:!0,autoPlay:!0,preload:"metadata",style:{width:"100%"}}),e.jsxs("div",{className:"controls",children:[e.jsx("button",{className:"th-m-btn",onClick:f,children:l?"Exit Theater":"Theater Mode"}),e.jsx("button",{onClick:v,children:j?"Normal Mode":"Dim Background"}),e.jsx("button",{onClick:()=>h(-10),children:"âª"}),e.jsx("button",{onClick:()=>h(10),children:"â©"}),e.jsxs("select",{onChange:r=>T(parseFloat(r.target.value)),defaultValue:"1",children:[e.jsx("option",{value:"0.5",children:"0.5x"}),e.jsx("option",{value:"1",children:"1x"}),e.jsx("option",{value:"1.5",children:"1.5x"}),e.jsx("option",{value:"2",children:"2x"})]})]})]}),e.jsx(R,{video:t}),e.jsx(V,{videoId:o})]}),e.jsx("div",{className:"recommended-videos",style:{flexDirection:l?"row":"column"},children:c.map(r=>(console.log("Video Data:",r),e.jsx(D,{video:r},r._id)))})]})}export{O as default};
